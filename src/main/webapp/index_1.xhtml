<!--
Job Management & Tracking System (JMTS)  
Copyright (C) 2022  D P Bennett & Associates Limited

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <https://www.gnu.org/licenses/>.

Email: info@dpbennett.com.jm
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://xmlns.jcp.org/jsf/html" 
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://java.sun.com/jsf/facelets"> 
    <h:head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />    
        <meta http-equiv="cache-control" content="max-age=0" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
        <meta http-equiv="pragma" content="no-cache" />
        <title>#{jobManager.applicationHeader}</title>        
        <script type="text/javascript" src="js/javascripts.js" />  
        <link rel="stylesheet" href="css/main.css" />
        <link rel="shortcut icon" type="image/x-icon" href="#{jobManager.appShortcutIconURL}" />
        <style type="text/css">

            .ui-widget {
                font-size: 0.975em !important;
            }

            .lightgreybg {
                background-color:lightgrey !important;
                background-image: none !important;
                color: #000000 !important;
            }
            .lightgreenbg {
                background-color:lightgreen !important;
                background-image: none !important;
                color: #000000 !important;
            }
            .orangeredbg {
                background-color:orangered !important;
                background-image: none !important;
                color: #000000 !important;
            }
            .yellowbg {
                background-color:yellow !important;
                background-image: none !important;
                color: #000000 !important;
            }

            .ui-sticky {
                top: 0px !important;
            }

            @media (max-width: 960px) {
                .ui-sticky {
                    top: 0px !important;
                }
            }

        </style>
    </h:head>
    <h:body>

        <ui:include src="common/commonDialogs.xhtml" />
        <ui:include src="admin/loginDialog.xhtml"/>  
        <ui:include src="common/userProfileDialog.xhtml"/>  
        <h:form id="appForm">          
            <p:splitter layout="vertical" rendered="#{systemManager.renderUserMenu()}">
                <p:splitterPanel size="100" >

                    <p:splitterPanel styleClass="p-d-flex p-ai-center p-jc-center" 
                                     size="20" minSize="20">

                        <p:growl id="growl3" life="5000" showDetail="true" />

                        <h:panelGrid columns="1" border="0" width="100%" >
                            <h:panelGrid width="100%" 
                                         border="0" columns="3" >

                                <p:graphicImage value="#{systemManager.logoURL}"
                                                height="#{systemManager.logoURLImageHeight}" 
                                                width="#{systemManager.logoURLImageWidth}"/>

                                <h:panelGrid columns="1">   

                                    <h:outputText value="#{jobManager.applicationHeader}"
                                                  style="color: darkgrey; font-size: 14pt; font-weight: bold;" />

                                    <h:outputText value="#{systemManager.applicationSubheader}"
                                                  styleClass="#{systemManager.isDebugMode eq true ? 'debug-mode' : 'non-debug-mode'}" />  

                                </h:panelGrid>
                                <h:panelGroup style="float: right;">
                                    <p:badge value="#{systemManager.sizeOfActiveNotifications}" 
                                             id="notificationBadge"
                                             visible="#{systemManager.hasActiveNotifications}" 
                                             severity="danger">

                                        <p:commandButton id="notifications" 
                                                         icon="pi pi-bell" />
                                        <p:overlayPanel for="notifications"   
                                                        widgetVar="NotificationPanelVar"
                                                        style="width:400px;border: 0;">
                                            <p:orderList value="#{systemManager.notifications}" 
                                                         var="notification" 
                                                         itemValue="#{notification}"
                                                         converter="#{notificationConverter}" 
                                                         controlsLocation="none" responsive="true" >

                                                <p:ajax event="select" 
                                                        update=":appForm:notificationBadge"
                                                        oncomplete="PF('NotificationPanelVar').hide()"
                                                        listener="#{financeManager.onNotificationSelect}" />
           
                                                <p:column>
                                                    <h:outputText value="#{notification.name}" 
                                                                  style="#{notification.style}"/>
                                                </p:column>                                           

                                            </p:orderList>
                                        </p:overlayPanel>

                                    </p:badge>
                                    <p:spacer width="30"/>
                                    <p:menuButton     
                                        iconPos="left"
                                        icon="pi pi-user"
                                        title="#{systemManager.user.employee.firstName} #{systemManager.user.employee.lastName} (#{systemManager.user.username})"
                                        id="userMenu"
                                        style="margin-right: 15px;" >

                                        <p:menuitem actionListener="#{systemManager.viewUserProfile}"                                            
                                                    update=":userProfileDialogForm"
                                                    oncomplete="PF('userProfileDialog').show();"
                                                    icon="pi pi-cog"
                                                    value="Profile"
                                                    process="@this"/>
                                        <p:separator />  
                                        <p:menuitem actionListener="#{systemManager.logout}"                                             
                                                    icon="pi pi-sign-out"
                                                    value="Logout"
                                                    oncomplete="window.location.reload();"
                                                    process="@this"/>    

                                    </p:menuButton>   
                                </h:panelGroup>
                            </h:panelGrid> 

                            
                            <ui:include src="menubar.xhtml"/>   


                        </h:panelGrid>

                        <p:sticky target="main_menubar"/>

                    </p:splitterPanel>                          

                </p:splitterPanel>
                <p:splitterPanel>
                    <p:splitter>
                        <p:splitterPanel styleClass="p-d-flex p-ai-center p-jc-center" 
                                         size="30" minSize="0">
                            <p:panel id="dashboardPanel" header="Dashboard">

                                <p:commandButton
                                    id="doGeneralSearchButton"
                                    style="visibility: hidden;"
                                    global="false"                                        
                                    value=""  
                                    update=""
                                    title="This is the default button that accepts the enter key press" 
                                    actionListener="#{jobManager.doDefaultSearch}"
                                    process="@form"/>                    

                                <p:defaultCommand id="dashboardDefaultCommandButton"
                                                  scope="dashboardPanel"
                                                  target=":appForm:doGeneralSearchButton" />

                                <ui:include src="dashboard/job/search.xhtml"/>

                            </p:panel>
                        </p:splitterPanel>     
                        <p:splitterPanel styleClass="p-d-flex p-ai-center p-jc-center" 
                                         size="70" minSize="65">

                            <p:tabView id="mainTabView"   
                                       rendered="#{systemManager.mainTabView.render}"
                                       value="#{systemManager.mainTabView.tabs}" 
                                       var="t"         
                                       style="border-width: 0px;"

                                       widgetVar="mainTabViewVar">

                                <p:ajax event="tabClose" 
                                        immediate="true"
                                        global="true"
                                        process="@this"
                                        update=""
                                        listener="#{systemManager.onMainViewTabClose}" />  

                                <p:ajax event="tabChange" 
                                        immediate="true"
                                        global="true"
                                        process="@this"                                
                                        listener="#{systemManager.onMainViewTabChange}" />  


                                <p:tab title="#{t.name}" closable="true"  >

                                    <h:panelGroup  rendered="#{t.id == 'Financial Administration'}">
                                        <ui:include src="finance/financialAdminTab.xhtml" /> 
                                    </h:panelGroup>

                                    <h:panelGroup rendered="#{t.id == 'Human Resource'}" >
                                        <ui:include src="hr/hrmTab.xhtml" /> 
                                    </h:panelGroup>

                                    <h:panelGroup rendered="#{t.id == 'System Administration'}" >
                                        <ui:include src="admin/generalAdminTab.xhtml" /> 
                                    </h:panelGroup>   

                                    <h:panelGroup rendered="#{t.id == 'Clients'}" >
                                        <ui:include src="client/clientsTab.xhtml" />                                                                
                                    </h:panelGroup>

                                    <h:panelGroup rendered="#{t.id == 'Reports'}" >
                                        <ui:include src="report/reportsTab.xhtml" />                                                                
                                    </h:panelGroup>

                                    <h:panelGroup rendered="#{t.id == 'Report Templates'}" >
                                        <ui:include src="report/reportTemplatesTab.xhtml" />                                                               
                                    </h:panelGroup>

                                    <h:panelGroup rendered="#{t.id == 'Job Browser'}">                                
                                        <ui:include src="job/jobBrowser.xhtml" /> 
                                    </h:panelGroup>

                                    <h:panelGroup rendered="#{t.id == 'Document Browser'}">                                
                                        <ui:include src="legal/documentBrowser.xhtml" />   
                                    </h:panelGroup>

                                    <h:panelGroup rendered="#{t.id == 'Purchase Requisitions'}" >
                                        <ui:include src="finance/purch/purchreqsTab.xhtml" />                                                                
                                    </h:panelGroup>

                                    <h:panelGroup rendered="#{t.id == 'Inventory'}" >
                                        <ui:include src="finance/ims/inventoryTab.xhtml" />                                                                
                                    </h:panelGroup>

                                    <h:panelGroup rendered="#{t.id == 'Inventory Requisitions'}" >
                                        <ui:include src="finance/ims/inventoryRequisitionTab.xhtml" />                                                                
                                    </h:panelGroup>

                                    <h:panelGroup rendered="#{t.id == 'Suppliers'}" >
                                        <ui:include src="finance/purch/suppliersTab.xhtml" />                                                                
                                    </h:panelGroup>

                                </p:tab>

                            </p:tabView> 

                            <p:commandButton
                                id="doNothingButton"
                                style="visibility: hidden;"
                                global="false"                                        
                                value=""                                       
                                title="This is the default button that accepts the enter key press"                                       
                                process="@this"/> 

                            <p:defaultCommand target=":appForm:doNothingButton" />

                        </p:splitterPanel>
                    </p:splitter>
                </p:splitterPanel>
            </p:splitter>

            <p:poll interval="240" 
                    global="false"
                    onerror="PF('connectionErrorDialog').show();"
                    listener="#{systemManager.handleKeepAlive}" />
        </h:form>
    </h:body>
</html>

